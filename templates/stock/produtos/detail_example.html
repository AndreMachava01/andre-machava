{% extends "base_detail.html" %}
{% load static %}

{% block title %}Detalhes do Produto{% endblock %}

{% block detail_cards %}
<!-- Informações Básicas -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-box"></i>Informações Básicas
        </h5>
    </div>
    <div class="card-body">
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-hashtag"></i>Código:
            </span>
            <span class="info-value">{{ produto.codigo }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-tag"></i>Nome:
            </span>
            <span class="info-value">{{ produto.nome }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-align-left"></i>Descrição:
            </span>
            <span class="info-value">{{ produto.descricao|default:"Não informado" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-toggle-on"></i>Status:
            </span>
            <span class="badge {% if produto.status == 'ATIVO' %}bg-success{% else %}bg-secondary{% endif %}">
                {{ produto.get_status_display }}
            </span>
        </div>
    </div>
</div>

<!-- Informações Comerciais -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-dollar-sign"></i>Informações Comerciais
        </h5>
    </div>
    <div class="card-body">
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-money-bill-wave"></i>Preço de Compra:
            </span>
            <span class="info-value" style="font-weight: 700; color: #dc3545;">
                {{ produto.preco_compra|floatformat:2 }} MT
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-tags"></i>Preço de Venda:
            </span>
            <span class="info-value" style="font-weight: 700; color: #28a745;">
                {{ produto.preco_venda|floatformat:2 }} MT
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-percentage"></i>Margem:
            </span>
            <span class="info-value" style="font-weight: 700; color: #17a2b8;">
                {% widthratio produto.preco_venda produto.preco_compra 100 as margem %}
                {{ margem|add:"-100" }}%
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-layer-group"></i>Categoria:
            </span>
            <span class="info-value">{{ produto.categoria.nome|default:"Não definido" }}</span>
        </div>
    </div>
</div>

<!-- Controle de Estoque -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-warehouse"></i>Controle de Estoque
        </h5>
    </div>
    <div class="card-body">
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-boxes"></i>Quantidade Atual:
            </span>
            <span class="info-value" style="font-weight: 700; color: #495057;">
                {{ produto.quantidade_atual|default:"0" }} unidades
            </span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-exclamation-triangle"></i>Estoque Mínimo:
            </span>
            <span class="info-value">{{ produto.estoque_minimo|default:"0" }} unidades</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-arrow-up"></i>Estoque Máximo:
            </span>
            <span class="info-value">{{ produto.estoque_maximo|default:"0" }} unidades</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-ruler"></i>Unidade de Medida:
            </span>
            <span class="info-value">{{ produto.unidade_medida|default:"Unidade" }}</span>
        </div>
    </div>
</div>

<!-- Informações Adicionais -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-info-circle"></i>Informações Adicionais
        </h5>
    </div>
    <div class="card-body">
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-building"></i>Fornecedor:
            </span>
            <span class="info-value">{{ produto.fornecedor.nome|default:"Não definido" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-calendar"></i>Data de Cadastro:
            </span>
            <span class="info-value">{{ produto.data_cadastro|date:"d/m/Y" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-calendar-check"></i>Última Atualização:
            </span>
            <span class="info-value">{{ produto.data_atualizacao|date:"d/m/Y H:i" }}</span>
        </div>
        <div class="info-row">
            <span class="info-label">
                <i class="fas fa-barcode"></i>Código de Barras:
            </span>
            <span class="info-value">{{ produto.codigo_barras|default:"Não informado" }}</span>
        </div>
    </div>
</div>

<!-- Histórico de Movimentações -->
{% if movimentacoes %}
<div class="card card-full-width">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-history"></i>Histórico de Movimentações
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th><i class="fas fa-calendar"></i> Data</th>
                        <th><i class="fas fa-exchange-alt"></i> Tipo</th>
                        <th><i class="fas fa-boxes"></i> Quantidade</th>
                        <th><i class="fas fa-user"></i> Responsável</th>
                        <th><i class="fas fa-comment"></i> Observações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mov in movimentacoes %}
                    <tr>
                        <td><strong>{{ mov.data|date:"d/m/Y H:i" }}</strong></td>
                        <td>
                            <span class="badge {% if mov.tipo == 'ENTRADA' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ mov.get_tipo_display }}
                            </span>
                        </td>
                        <td>{{ mov.quantidade }} {{ produto.unidade_medida }}</td>
                        <td>{{ mov.responsavel.nome|default:"Sistema" }}</td>
                        <td>{{ mov.observacoes|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
