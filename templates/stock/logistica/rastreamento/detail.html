{% extends "base_admin.html" %}
{% load static %}

{% block title %}Detalhes do Rastreamento - {{ rastreamento.codigo_rastreamento }}{% endblock %}

{% block extra_style %}

{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1 class="page-title"><i class="fas fa-shipping-fast"></i> {{ rastreamento.codigo_rastreamento }}</h1>
        <div class="header-actions">
            <a href="#"stock:logistica:rastreamento_list' %}" class="btn btn btn btn btn btn btn btn-secondary btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive"><i class="fas fa-arrow-left"></i> Voltar</a>
            <a href="#"stock:logistica:operacoes_list' %}" class="btn btn btn btn btn btn btn btn-primary btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive btn-responsive"><i class="fas fa-tasks"></i> Operações</a>
        </div>
    </div>
    <div class="page-content">
        <div class="grid">
            <div class="card">
                <h3><i class="fas fa-info-circle"></i> Informações Gerais</h3>
                <div class="item"><div class="label">Código:</div><div><strong>{{ rastreamento.codigo_rastreamento }}</strong></div></div>
                <div class="item"><div class="label">Status:</div><div><span class="status-badge">{{ rastreamento.get_status_atual_display }}</span></div></div>
                <div class="item"><div class="label">Transportadora:</div><div>{{ rastreamento.transportadora.nome|default:"-" }}</div></div>
                <div class="item"><div class="label">Criado em:</div><div>{{ rastreamento.data_criacao|date:"d/m/Y H:i" }}</div></div>
                <div class="item"><div class="label">Criado por:</div><div>{{ rastreamento.criado_por.username|default:"Sistema" }}</div></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-user"></i> Destinatário</h3>
                <div class="item"><div class="label">Nome:</div><div>{{ rastreamento.destinatario_nome }}</div></div>
                <div class="item"><div class="label">Telefone:</div><div>{{ rastreamento.destinatario_telefone|default:"-" }}</div></div>
                <div class="item"><div class="label">Endereço:</div><div>{{ rastreamento.endereco_entrega }}</div></div>
                <div class="item"><div class="label">Cidade:</div><div>{{ rastreamento.cidade_entrega }}</div></div>
                <div class="item"><div class="label">Província:</div><div>{{ rastreamento.provincia_entrega }}</div></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-box"></i> Envio</h3>
                <div class="item"><div class="label">Peso|default:0 total:</div><div>{{ rastreamento.peso_total|default:"-" }} kg</div></div>
                <div class="item"><div class="label">Valor Declarado:</div><div>{{ rastreamento.valor_declarado|default:"-" }} MT</div></div>
                <div class="item"><div class="label">Custo Envio:</div><div>{{ rastreamento.custo_envio|default:"-" }} MT</div></div>
                <div class="item"><div class="label">Prevista:</div><div>{{ rastreamento.data_entrega_prevista|date:"d/m/Y H:i"|default:"-" }}</div></div>
                <div class="item"><div class="label">Coleta:</div><div>{{ rastreamento.data_coleta|date:"d/m/Y H:i"|default:"-" }}</div></div>
                <div class="item"><div class="label">Entrega:</div><div>{{ rastreamento.data_entrega_realizada|date:"d/m/Y H:i"|default:"-" }}</div></div>
            </div>

            <div class="card">
                <h3><i class="fas fa-file-alt"></i> Documento de Origem</h3>
                {% if rastreamento.transferencia %}
                <div class="item"><div class="label">Tipo:</div><div>Transferência</div></div>
                <div class="item"><div class="label">Código:</div><div>{{ rastreamento.transferencia.codigo }}</div></div>
                <div class="item"><div class="label">Origem:</div><div>{{ rastreamento.transferencia.sucursal_origem.nome }}</div></div>
                <div class="item"><div class="label">Destino:</div><div>{{ rastreamento.transferencia.sucursal_destino.nome }}</div></div>
                {% elif rastreamento.ordem_compra %}
                <div class="item"><div class="label">Tipo:</div><div>Ordem de Compra</div></div>
                <div class="item"><div class="label">Código:</div><div>{{ rastreamento.ordem_compra.codigo }}</div></div>
                <div class="item"><div class="label">Fornecedor:</div><div>{{ rastreamento.ordem_compra.fornecedor.nome|default:"-" }}</div></div>
                <div class="item"><div class="label">Destino:</div><div>{{ rastreamento.ordem_compra.sucursal_destino.nome }}</div></div>
                {% else %}
                <div class="item"><div class="label">Estado:</div><div class="muted">Sem documento de origem</div></div>
                {% endif %}
            </div>
        </div>

        {% if rastreamento.observacoes %}
        <div class="card" style="margin-top:16px;">
            <h3><i class="fas fa-sticky-note"></i> Observações</h3>
            <div class="muted">{{ rastreamento.observacoes }}</div>
        </div>
        {% endif %}

        <div class="card" style="margin-top:16px;">
            <h3><i class="fas fa-history"></i> Histórico de Eventos</h3>
            {% if eventos %}
            <div class="timeline">
                {% for evento in eventos %}
                <div class="timeline-item">
                    <div class="timeline-header">
                        <span>{{ evento.get_tipo_evento_display }}</span>
                        <span class="muted">{{ evento.data_evento|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div class="timeline-description">{{ evento.descricao }}</div>
                    {% if evento.localizacao %}<div class="muted"><i class="fas fa-map-marker-alt"></i> {{ evento.localizacao }}</div>{% endif %}
                    {% if evento.usuario %}<div class="muted"><i class="fas fa-user"></i> {{ evento.usuario.username }}</div>{% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="muted">Nenhum evento registado.</div>
            {% endif %}
            <!-- eventos são gerados pelas ações da operação -->
        </div>
    </div>
</div>
{% endblock %}
