{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Atribuir Transporte{% endblock %}

{% block extra_style %}
<style>
    .page-header,
    .hero-section,
    .dashboard-header,
    .nav-top {
        background: var(--purple-gradient);
    }

    .breadcrumb-modern {
        background: #1f2937;
        border-radius: 10px;
        padding: 15px 20px;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .breadcrumb-modern a {
        color: #06b6d4;
        text-decoration: none;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .breadcrumb-modern a:hover {
        text-decoration: underline;
    }

    .breadcrumb-modern span {
        color: #e5e7eb;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .breadcrumb-modern i {
        color: #6b7280;
    }

    .breadcrumb-modern i.fas.fa-chevron-right {
        font-size: 0.7rem;
        margin: 0 5px;
    }

    .page-header {
        background: var(--purple-gradient);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        color: white;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .page-header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .page-subtitle {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.8);
    }

    .form-card {
        background: #1f2937;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: 1px solid #374151;
    }

    .form-card h3 {
        color: #e5e7eb;
        margin-bottom: 25px;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        margin-bottom: 8px;
        color: #d1d5db;
        font-weight: 600;
        font-size: 1rem;
    }

    .form-control, .form-select {
        width: 100%;
        padding: 12px 15px;
        border-radius: 10px;
        border: 1px solid #4b5563;
        background-color: #374151;
        color: #e5e7eb;
        font-size: 1rem;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: #06b6d4;
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.3);
        outline: none;
    }

    .form-select option {
        background-color: #374151;
        color: #e5e7eb;
    }

    .form-text {
        color: #9ca3af;
        font-size: 0.9rem;
        margin-top: 5px;
    }

    .transport-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 25px;
    }

    .transport-option {
        background: #374151;
        border-radius: 15px;
        padding: 25px;
        border: 2px solid #4b5563;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .transport-option:hover {
        border-color: #06b6d4;
        transform: translateY(-2px);
    }

    .transport-option.selected {
        border-color: #06b6d4;
        background: rgba(6, 182, 212, 0.1);
    }

    .transport-option h4 {
        color: #e5e7eb;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .transport-option p {
        color: #9ca3af;
        font-size: 0.9rem;
        margin-bottom: 15px;
    }

    .transport-option input[type="radio"] {
        margin-right: 8px;
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        flex-wrap: wrap;
    }

    .btn {
        padding: 12px 24px;
        border-radius: 10px;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }

    .btn-primary {
        background: var(--blue-gradient);
        color: white;
    }

    .btn-secondary {
        background: #6b7280;
        color: white;
    }

    .btn:hover {
        transform: translateY(-2px);
        opacity: 0.9;
    }

    .errorlist {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid #ef4444;
        border-radius: 8px;
        padding: 10px;
        margin-top: 5px;
        list-style: none;
    }

    .errorlist li {
        margin-bottom: 5px;
    }

    .errorlist li:last-child {
        margin-bottom: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb-modern">
        <a href="/dashboard/">
            <i class="fas fa-home"></i>
            Dashboard
        </a>
        <i class="fas fa-chevron-right"></i>
        <a href="/stock/">
            <i class="fas fa-warehouse"></i>
            Stock
        </a>
        <i class="fas fa-chevron-right"></i>
        <a href="{% url 'stock:logistica:main' %}">
            <i class="fas fa-truck"></i>
            Logística
        </a>
        <i class="fas fa-chevron-right"></i>
        <a href="{% url 'stock:logistica:operacoes_list' %}">
            <i class="fas fa-tasks"></i>
            Operações
        </a>
        <i class="fas fa-chevron-right"></i>
        <span>Atribuir Transporte</span>
    </nav>

    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <div>
                <h1 class="page-title">
                    <i class="fas fa-truck-loading"></i>
                    Atribuir Transporte
                </h1>
                <p class="page-subtitle">
                    {{ notificacao.get_tipo_operacao_display }} - {{ notificacao.codigo_operacao }}
                </p>
            </div>
        </div>
    </div>

    <!-- Formulário -->
    <form method="post"action="."method="post">{% csrf_token %}
        {% csrf_token %}
        
        <div class="form-card">
            <h3><i class="fas fa-truck"></i> Tipo de Transporte</h3>
            
            <div class="transport-options">
                <div class="transport-option" onclick="VEICULO_INTERNO')"" tabindex="0">
                    <h4><i class="fas fa-car"></i> Veículo Interno</h4>
                    <p>Utilizar uma viatura interna da empresa para realizar o transporte.</p>
                    <label>
                        <input type="radio" name="tipo_transporte" value="VEICULO_INTERNO" required>
                        Selecionar Veículo Interno
                    </label>
                </div>
                
                <div class="transport-option" onclick="TRANSPORTADORA_EXTERNA')"" tabindex="0">
                    <h4><i class="fas fa-building"></i> Transportadora Externa</h4>
                    <p>Contratar uma transportadora externa para realizar o transporte.</p>
                    <label>
                        <input type="radio" name="tipo_transporte" value="TRANSPORTADORA_EXTERNA" required>
                        Selecionar Transportadora Externa
                    </label>
                </div>
            </div>
        </div>

        <!-- Veículos Internos -->
        <div class="form-card" id="veiculos-internos" style="display: none;">
            <h3><i class="fas fa-car"></i> Veículos Internos Disponíveis</h3>
            
            <div class="form-group">
                <label for="veiculo_interno" class="form-label">Selecionar Veículo</label>
                <select name="veiculo_interno" id="veiculo_interno" class="form-select">
                    <option value="">Selecione um veículo...</option>
                    {% for veiculo in veiculos_internos %}
                    <option value="{{ veiculo.id }}">
                        {{ veiculo.nome }} - {{ veiculo.placa }} ({{ veiculo.get_tipo_display }})
                    </option>
                    {% endfor %}
                </select>
                <div class="form-text">Apenas veículos ativos estão listados.</div>
            </div>
        </div>

        <!-- Transportadoras Externas -->
        <div class="form-card" id="transportadoras-externas" style="display: none;">
            <h3><i class="fas fa-building"></i> Transportadoras Externas Disponíveis</h3>
            
            <div class="form-group">
                <label for="transportadora_externa" class="form-label">Selecionar Transportadora</label>
                <select name="transportadora_externa" id="transportadora_externa" class="form-select">
                    <option value="">Selecione uma transportadora...</option>
                    {% for transportadora in transportadoras_externas %}
                    <option value="{{ transportadora.id }}">
                        {{ transportadora.nome }} ({{ transportadora.get_tipo_display }})
                    </option>
                    {% endfor %}
                </select>
                <div class="form-text">Apenas transportadoras ativas estão listadas.</div>
            </div>
        </div>

        <!-- Observações -->
        <div class="form-card">
            <h3><i class="fas fa-sticky-note"></i> Observações</h3>
            
            <div class="form-group">
                <label for="observacoes" class="form-label">Observações Adicionais</label>
                <textarea name="observacoes" id="observacoes" class="form-control" rows="4" placeholder="Adicione observações sobre o transporte..."></textarea>
                <div class="form-text">Informações adicionais sobre a operação logística.</div>
            </div>
        </div>

        <!-- Ações -->
        <div class="action-btns -responsive">
            <button type="submit" class="btn btn-primary" class="btn btn btn-primary btn-responsive -responsive" id="btn-{{ forloop.counter|default:"1" }}" aria-label="Botão de ação" title="Clique para executar ação" title="Clique para executar ação">
                <i class="fas fa-check"></i>
                Atribuir Transporte
            </button>
            <a href="#"stock:logistica:operacao_detail' notificacao.id %}" class="btn btn btn-secondary btn-responsive -responsive">
                <i class="fas fa-times"></i>
                Cancelar
            </a>
        </div>
    </form>

</div>

<script>
function selectTransport(tipo) {
    // Remover seleção anterior
    document.querySelectorAll('.transport-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    // Adicionar seleção atual
    event.currentTarget.classList.add('selected');
    
    // Marcar radio button
    document.querySelector(`input[value="${tipo}"]`).checked = true;
    
    // Mostrar/esconder seções
    if (tipo === 'VEICULO_INTERNO') {
        document.getElementById('veiculos-internos').style.display = 'block';
        document.getElementById('transportadoras-externas').style.display = 'none';
        document.getElementById('transportadora_externa').value = '';
    } else {
        document.getElementById('veiculos-internos').style.display = 'none';
        document.getElementById('transportadoras-externas').style.display = 'block';
        document.getElementById('veiculo_interno').value = '';
    }
}
</script>
{% endblock %}


