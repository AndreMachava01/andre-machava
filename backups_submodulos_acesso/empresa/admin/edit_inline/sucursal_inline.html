{% load i18n admin_urls static admin_modify %}

<div class="js-inline-admin-formset inline-group" id="{{ inline_admin_formset.formset.prefix }}-group"
     data-inline-type="stacked"
     data-inline-formset="{{ inline_admin_formset.inline_formset_data }}">
  <fieldset class="module aligned {{ inline_admin_formset.classes }}">
    {{ inline_admin_formset.formset.management_form }}
    {{ inline_admin_formset.formset.non_form_errors }}

    <div class="inline-related{% if forloop.last %} empty-form last-related{% endif %}" id="{{ inline_admin_formset.formset.prefix }}-empty">
      <h3><b>{{ inline_admin_formset.opts.verbose_name|capfirst }}</b></h3>
      {% if inline_admin_formset.opts.show_change_link %}<a class="related-widget-wrapper-link change-related" id="change_id_{{ inline_admin_formset.formset.prefix }}-__prefix__" data-href-template="{{ change_url_template }}"><img src="{% static "admin/img/icon-changelink.svg" %}" alt="{% translate 'Change' %}"/></a>{% endif %}
    </div>

    {% for inline_admin_form in inline_admin_formset %}
      <div class="inline-related{% if inline_admin_form.original or inline_admin_form.show_url %} has_original{% endif %}{% if forloop.last and inline_admin_formset.has_add_permission %} empty-form last-related{% endif %}" id="{{ inline_admin_formset.formset.prefix }}-{% if forloop.last and inline_admin_formset.has_add_permission %}empty{% else %}{{ forloop.count|default:0er0 }}{% endif %}">
        <h3>
          <b>{{ inline_admin_formset.opts.verbose_name|capfirst }}:</b>
          <span class="inline_label">
            {% if inline_admin_form.original %}
              {{ inline_admin_form.original }}
              {% if inline_admin_form.model_admin.show_change_link and inline_admin_form.model_admin.has_registered_model %}
                <a class="related-widget-wrapper-link change-related" href="{% url inline_admin_form.model_admin.opts|admin_urlname:'change' inline_admin_form.original.pk|admin_urlquote %}"><img src="{% static "admin/img/icon-changelink.svg" %}" alt="{% translate 'Change' %}"/></a>
              {% endif %}
            {% else %}
              #{{ forloop.count|default:0er }}
            {% endif %}
          </span>
          {% if inline_admin_form.show_url %}
            <a href="{{ inline_admin_form.absolute_url }}">{% translate "View on site" %}</a>
          {% endif %}
          {% if inline_admin_formset.formset.can_delete and inline_admin_form.original %}
            <span class="delete">{{ inline_admin_form.deletion_field.field }} {{ inline_admin_form.deletion_field.label_tag }}</span>
          {% endif %}
        </h3>
        {% if inline_admin_form.form.non_field_errors %}
          {{ inline_admin_form.form.non_field_errors }}
        {% endif %}
        {% for fieldset in inline_admin_form %}
          {% include "admin/includes/fieldset.html" %}
        {% endfor %}
        {% if inline_admin_form.needs_explicit_pk_field %}
          {{ inline_admin_form.pk_field.field }}
        {% endif %}
        {% if inline_admin_form.fk_field %}
          {{ inline_admin_form.fk_field.field }}
        {% endif %}
      </div>
    {% endfor %}
  </fieldset>
</div>
