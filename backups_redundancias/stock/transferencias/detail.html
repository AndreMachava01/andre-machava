{% extends "base_admin.html" %}
{% load static %}

{% block title %}Transferência {{ transferencia.codigo }}{% endblock %}

{% block extra_style %}

{% endblock %}

{% block content %}
<div class="modern-container">
    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb-section">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url "dashboard" %}">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{% url "stock:main" %}">
                        <i class="fas fa-warehouse"></i> Stock
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="">
                        <i class="fas fa-exchange-alt"></i> Transferências
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <i class="fas fa-eye"></i> {{ transferencia.codigo }}
                </li>
            </ol>
        </nav>
    </div>

    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">
                <i class="fas fa-exchange-alt"></i>
                Transferência {{ transferencia.codigo }}
                {% if transferencia.status == 'RASCUNHO' %}
                    <span class="status-badge status-rascunho">
                        <i class="fas fa-edit"></i>Rascunho
                    </span>
                {% elif transferencia.status == 'PENDENTE' %}
                    <span class="status-badge status-pendente">
                        <i class="fas fa-clock"></i>Pendente
                    </span>
                {% elif transferencia.status == 'ENVIADA' %}
                    <span class="status-badge status-enviada">
                        <i class="fas fa-truck"></i>Enviada
                    </span>
                {% elif transferencia.status == 'RECEBIDA' %}
                    <span class="status-badge status-recebida">
                        <i class="fas fa-check"></i>Recebida
                    </span>
                {% elif transferencia.status == 'CANCELADA' %}
                    <span class="status-badge status-cancelada">
                        <i class="fas fa-times"></i>Cancelada
                    </span>
                {% endif %}
            </h1>
            <div class="hero-actions">
                <a href="{% url "stock:transferencias:list" %}" class="btn-modern -primary-modern">
                    <i class="fas fa-arrow-left"></i>Voltar
                </a>
                
                {% if pode_adicionar_itens %}
                    <a href="{% url 'stock:transferencias:add_item' transferencia.id %}" class="btn-modern -primary-modern">
                        <i class="fas fa-plus"></i>Adicionar|default:0 items
                    </a>
                {% endif %}
                
                {% if pode_confirmar_envio %}
                    <a href="#"stock:transferencias:confirmar_envio' transferencia.id %}" 
                       class="btn-modern -success-modern" 
                       href="#" onclick="event.preventDefault(); return "Confirmar envio desta transferência?')">
                        <i class="fas fa-truck"></i>Confirmar Envio
                    </a>
                {% endif %}
                
                {% if pode_receber %}
                    <a href="{% url 'stock:transferencias:receber' transferencia.id %}" class="btn-modern -primary-modern">
                        <i class="fas fa-download"></i>Receber
                    </a>
                {% endif %}
                
                {% if pode_cancelar %}
                    <a href="#"stock:transferencias:cancelar' transferencia.id %}" 
                       class="btn-modern -danger-modern"
                       href="#" onclick="event.preventDefault(); return "Tem certeza que deseja cancelar esta transferência?')">
                        <i class="fas fa-times"></i>Cancelar
                    </a>
                {% endif %}
                
                {% if pode_apagar %}
                    <a href="#"stock:transferencias:apagar' transferencia.id %}" 
                       class="btn-modern -danger-modern"
                       href="#" onclick="event.preventDefault(); return "Tem certeza que deseja APAGAR esta transferência? Esta ação não pode ser desfeita.')">
                        <i class="fas fa-trash"></i>Apagar
                    </a>
                {% endif %}
                
                <!-- Documentos Impressíveis -->
                {% if transferencia.status == 'ENVIADA' or transferencia.status == 'RECEBIDA' %}
                    <a href="{% url 'stock:transferencias:guia_transferencia' transferencia.id %}" 
                       class="btn-modern -info-modern" target="_blank">
                        <i class="fas fa-file-alt"></i>Guia de Transferência
                    </a>
                {% endif %}
                
                {% if transferencia.status == 'RECEBIDA' %}
                    <a href="{% url 'stock:transferencias:nota_recebimento' transferencia.id %}" 
                       class="btn-modern -success-modern" target="_blank">
                        <i class="fas fa-receipt"></i>Nota de Recebimento
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="summary-card">
            <div class="summary-value">{{ itens.count }}</div>
            <div class="summary-card h3">Total de Itens</div>
        </div>
        <div class="summary-card">
            <div class="summary-value">
                {% if itens %}
                    {% for items in itens  %}
                        {% if forloop.first %}{{ item.quantidade_solicitada }}{% endif %}
                    {% endfor %}
                {% else %}
                    0
                {% endif %}
            </div>
            <div class="summary-card h3">Unidades Solicitadas</div>
        </div>
        <div class="summary-card">
            <div class="summary-value">
                {% if itens %}
                    {% for items in itens  %}
                        {% if forloop.first %}{{ item.quantidade_recebida }}{% endif %}
                    {% endfor %}
                {% else %}
                    0
                {% endif %}
            </div>
            <div class="summary-card h3">Unidades Recebidas</div>
        </div>
        <div class="summary-card">
            <div class="summary-value">
                {% if itens %}
                    {% for items in itens  %}
                        {% if forloop.first %}{{ item.quantidade_pendente }}{% endif %}
                    {% endfor %}
                {% else %}
                    0
                {% endif %}
            </div>
            <div class="summary-card h3">Unidades Pendentes</div>
        </div>
    </div>

    <!-- Content Section -->
    <div class="content-section">
        <!-- Info Grid -->
        <div class="info-grid">
            <div class="info-card">
                <h3 class="info-title">
                    <i class="fas fa-info-circle"></i>
                    Informações Básicas
                </h3>
                <div class="info-item">
                    <span class="info-label">Código:</span>
                    <span class="info-value">{{ transferencia.codigo }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Data de Criação:</span>
                    <span class="info-value">{{ transferencia.data_criacao|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Criado por:</span>
                    <span class="info-value">{{ transferencia.criado_por.username|default:"N/A" }}</span>
                </div>
                {% if transferencia.data_envio %}
                <div class="info-item">
                    <span class="info-label">Data de Envio:</span>
                    <span class="info-value">{{ transferencia.data_envio|date:"d/m/Y H:i" }}</span>
                </div>
                {% endif %}
                {% if transferencia.data_recebimento %}
                <div class="info-item">
                    <span class="info-label">Data de Recebimento:</span>
                    <span class="info-value">{{ transferencia.data_recebimento|date:"d/m/Y H:i" }}</span>
                </div>
                {% endif %}
            </div>

            <div class="info-card">
                <h3 class="info-title">
                    <i class="fas fa-route"></i>
                    Rota da Transferência
                </h3>
                <div class="info-item">
                    <span class="info-label">Origem:</span>
                    <span class="info-value">{{ transferencia.sucursal_origem.nome }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Destino:</span>
                    <span class="info-value">{{ transferencia.sucursal_destino.nome }}</span>
                </div>
                <div class="route-info">
                    <i class="fas fa-building text-primary"></i>
                    <span>{{ transferencia.sucursal_origem.nome }}</span>
                    <i class="fas fa-arrow-right route-arrow"></i>
                    <i class="fas fa-building text-success"></i>
                    <span>{{ transferencia.sucursal_destino.nome }}</span>
                </div>
                {% if transferencia.observacoes %}
                <div class="info-item">
                    <span class="info-label">Observações:</span>
                    <span class="info-value">{{ transferencia.observacoes }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Items Section -->
        <div class="items-section">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-boxes"></i>
                    Itens da Transferência
                </h3>
            </div>

            {% if itens %}
                <div class="items-table-container">
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Solicitada</th>
                                <th>Recebida</th>
                                <th>Pendente</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for items in itens  %}
                            <tr>
                                <td class="product-cell">
                                    <div class="product-info">
                                        <span class="product-name">{{ item.produto.nome }}</span>
                                        <span class="product-code">{{ item.produto.codigo }}</span>
                                    </div>
                                </td>
                                <td class="quantity-cell">
                                    <span class="quantity-badge badge-secondary">{{ item.quantidade_solicitada }}</span>
                                </td>
                                <td class="quantity-cell">
                                    <span class="quantity-badge badge-success">{{ item.quantidade_recebida }}</span>
                                </td>
                                <td class="quantity-cell">
                                    <span class="quantity-badge badge-warning">{{ item.quantidade_pendente }}</span>
                                </td>
                                <td class="status-cell">
                                    {% if items.total|default:0mente_recebido  %}
                                        <span class="quantity-badge badge-success">
                                            <i class="fas fa-check"></i> Completo
                                        </span>
                                    {% elif items.quantidade_recebida > 0  %}
                                        <span class="quantity-badge badge-warning">
                                            <i class="fas fa-clock"></i> Parcial
                                        </span>
                                    {% else %}
                                        <span class="quantity-badge badge-secondary">
                                            <i class="fas fa-hourglass-half"></i> Pendente
                                        </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-boxes"></i>
                    <h4>Nenhum|default:0 items nesta transferência</h4>
                    <p>Esta transferência ainda não possui itens adicionados.</p>
                    {% if pode_adicionar_itens %}
                        <a href="{% url 'stock:transferencias:add_item' transferencia.id %}" class="btn-modern -primary-modern">
                            <i class="fas fa-plus"></i>Adicionar Primeiro|default:0 items
                        </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}