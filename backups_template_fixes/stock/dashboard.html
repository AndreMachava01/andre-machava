<script>

let charts = {};

// Configuração padrão do Chart.js para tema escuro
Chart.defaults.font.family = "'Inter', sans-serif";
Chart.defaults.font.size = 12;
Chart.defaults.color = '#d1d5db';

// Inicializar gráficos
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM carregado, inicializando gráficos...');
    initializeCharts();
});

// Função de teste para verificar se os cliques estão funcionando
function testClick() {
    console.log('=== ATUALIZANDO GRÁFICOS ===');
    console.log('Botão funcionando corretamente');
    console.log('=============================');
    
    // Chamar a função original
    updateCharts();
}

// Função de debug (disponível no console)
function debugElements() {
    console.log('=== DEBUG ELEMENTOS ===');
    console.log('periodoSelect:', document.getElementById('periodoSelect'));
    console.log('tipoItemSelect:', document.getElementById('tipoItemSelect'));
    console.log('updateButton:', document.querySelector('button[onclick="testClick()"]'));
    console.log('charts object:', charts);
    console.log('=======================');
}

function initializeCharts() {
    // Gráfico de Movimentações
    const movimentacoesCtx = document.getElementById('movimentacoesChart').getContext('2d');
    charts.movimentacoes = new Chart(movimentacoesCtx, {
        type: 'bar',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 2,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#d1d5db'
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                }
            }
        }
    });

    // Gráfico de Estoque por Sucursal
    const estoqueSucursalCtx = document.getElementById('estoqueSucursalChart').getContext('2d');
    charts.estoqueSucursal = new Chart(estoqueSucursalCtx, {
        type: 'doughnut',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 1,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#d1d5db'
                    }
                }
            }
        }
    });

    // Gráfico de Categorias
    const categoriasCtx = document.getElementById('categoriasChart').getContext('2d');
    charts.categorias = new Chart(categoriasCtx, {
        type: 'bar',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 2,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#d1d5db'
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    beginAtZero: true,
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                }
            }
        }
    });

    // Gráfico de Tendências
    const tendenciasCtx = document.getElementById('tendenciasChart').getContext('2d');
    charts.tendencias = new Chart(tendenciasCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            aspectRatio: 2,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#d1d5db'
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                },
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: '#d1d5db'
                    },
                    grid: {
                        color: '#4b5563'
                    }
                }
            }
        }
    });

    // Carregar dados iniciais
    updateCharts();
}

function updateCharts() {
    console.log('Atualizando gráficos...');
    
    // Verificar se os elementos existem
    const periodoSelect = document.getElementById('periodoSelect');
    const tipoItemSelect = document.getElementById('tipoItemSelect');
    
    const periodo = periodoSelect ? periodoSelect.value : '30';
    const tipoItem = tipoItemSelect ? tipoItemSelect.value : '';
    
    console.log('Período:', periodo, 'Tipo|default:0 items:', tipoItem);
    
    // Mostrar indicador de carregamento
    const updateButton = document.querySelector('button[onclick="updateCharts()"]');
    if (updateButton) {
        const originalText = updateButton.innerHTML;
        updateButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
        updateButton.disabled = true;
        
        // Restaurar botão após 3 segundos
        setTimeout(() => {
            updateButton.innerHTML = originalText;
            updateButton.disabled = false;
        }, 3000);
    }
    
    // Atualizar gráfico de movimentações
    fetch(`/stock/dashboard/chart-movimentacoes/?dias=${periodo}&tipo_item=${tipoItem}`)
        .then(response => {
            console.log('Resposta movimentações:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Dados movimentações:', data);
            if (data.error) {
                console.error('Erro ao carregar movimentações:', data.error);
                return;
            }
            if (charts.movimentacoes) {
                charts.movimentacoes.data.labels = data.labels;
                charts.movimentacoes.data.datasets = data.datasets;
                charts.movimentacoes.update();
                console.log('Gráfico movimentações atualizado');
            }
        })
        .catch(error => console.error('Erro movimentações:', error));

    // Atualizar gráfico de estoque por sucursal
    fetch('/stock/dashboard/chart-estoque-sucursal/')
        .then(response => {
            console.log('Resposta estoque sucursal:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Dados estoque sucursal:', data);
            if (data.error) {
                console.error('Erro ao carregar estoque sucursal:', data.error);
                return;
            }
            if (charts.estoqueSucursal) {
                charts.estoqueSucursal.data.labels = data.labels;
                charts.estoqueSucursal.data.datasets = data.datasets;
                charts.estoqueSucursal.update();
                console.log('Gráfico estoque sucursal atualizado');
            }
        })
        .catch(error => console.error('Erro estoque sucursal:', error));

    // Atualizar gráfico de categorias
    fetch('/stock/dashboard/chart-categorias/')
        .then(response => {
            console.log('Resposta categorias:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Dados categorias:', data);
            if (data.error) {
                console.error('Erro ao carregar categorias:', data.error);
                return;
            }
            if (charts.categorias) {
                charts.categorias.data.labels = data.labels;
                charts.categorias.data.datasets = data.datasets;
                charts.categorias.update();
                console.log('Gráfico categorias atualizado');
            }
        })
        .catch(error => console.error('Erro categorias:', error));

    // Atualizar gráfico de tendências
    fetch(`/stock/dashboard/chart-tendencias/?dias=${periodo}`)
        .then(response => {
            console.log('Resposta tendências:', response.status);
            return response.json();
        })
        .then(data => {
            console.log('Dados tendências:', data);
            if (data.error) {
                console.error('Erro ao carregar tendências:', data.error);
                return;
            }
            if (charts.tendencias) {
                charts.tendencias.data.labels = data.labels;
                charts.tendencias.data.datasets = data.datasets;
                charts.tendencias.update();
                console.log('Gráfico tendências atualizado');
            }
        })
        .catch(error => console.error('Erro tendências:', error));
}

// Atualizar gráficos a cada 5 minutos
setInterval(updateCharts, 300000);

// Redimensionar gráficos quando a janela for redimensionada
window.addEventListener('resize', function() {
    if (charts.movimentacoes) charts.movimentacoes.resize();
    if (charts.estoqueSucursal) charts.estoqueSucursal.resize();
    if (charts.categorias) charts.categorias.resize();
    if (charts.tendencias) charts.tendencias.resize();
});

</script>

{% extends 'base_admin.html' %}
{% load static %}

{% block title %}Dashboard Executivo - Stock{% endblock %}

{% block extra_style %}
<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        --danger-gradient: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
        --info-gradient: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
        --purple-gradient: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
        --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 10px 15px rgba(0, 0, 0, 0.1);
        --shadow-heavy: 0 20px 25px rgba(0, 0, 0, 0.1);
    }

    body {
        background: #1f2937;
        min-height: 100vh;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        color: white;
    }

    .dashboard-container {
        background: #374151;
        border-radius: 20px;
        border: 1px solid #4b5563;
        box-shadow: var(--shadow-medium);
        margin: 10px;
        padding: 0;
        overflow: hidden;
        min-height: calc(100vh - 20px);
    }

    .dashboard-header {
        background: var(--primary-gradient);
        padding: 20px 30px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .dashboard-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }

    /* Garantir que os botões sejam clicáveis */
    .dashboard-header button,
    .dashboard-header a {
        pointer-events: auto !important;
        z-index: 1001 !important;
        position: relative !important;
    }

    .dashboard-header button:hover,
    .dashboard-header a:hover {
        pointer-events: auto !important;
        z-index: 1002 !important;
    }

    .dashboard-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 0;
        text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        position: relative;
        z-index: 2;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .dashboard-subtitle {
        font-size: 1.1rem;
        margin: 10px 0 0 0;
        opacity: 0.9;
        position: relative;
        z-index: 2;
    }

    .dashboard-content {
        padding: 30px;
        background: #1f2937;
    }

    /* Cards de Métricas */
    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .metric-card {
        background: #374151;
        border-radius: 16px;
        padding: 25px;
        border: 1px solid #4b5563;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .metric-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-heavy);
        border-color: #6b7280;
    }

    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
    }

    .metric-card.success::before { background: var(--success-gradient); }
    .metric-card.warning::before { background: var(--warning-gradient); }
    .metric-card.danger::before { background: var(--danger-gradient); }
    .metric-card.info::before { background: var(--info-gradient); }
    .metric-card.purple::before { background: var(--purple-gradient); }

    .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .metric-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .metric-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: white;
    }

    .metric-icon.success { background: var(--success-gradient); }
    .metric-icon.warning { background: var(--warning-gradient); }
    .metric-icon.danger { background: var(--danger-gradient); }
    .metric-icon.info { background: var(--info-gradient); }
    .metric-icon.purple { background: var(--purple-gradient); }

    .metric-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #f9fafb;
        margin-bottom: 5px;
        line-height: 1;
    }

    .metric-description {
        font-size: 0.9rem;
        color: #d1d5db;
        margin: 0;
    }

    /* Seções de Conteúdo */
    .content-sections {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .content-section {
        background: #374151;
        border-radius: 16px;
        padding: 25px;
        border: 1px solid #4b5563;
    }

    .section-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #f9fafb;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .section-title i {
        color: #8b5cf6;
    }

    /* Alertas */
    .alert {
        background: #374151;
        border: 1px solid #4b5563;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s ease;
    }

    .alert:hover {
        background: #4b5563;
        transform: translateX(5px);
    }

    .alert

    .alert

    .alert

    .alert-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: white;
    }

    .alert.warning 
    .alert.danger 
    .alert.info 

    .alert-content {
        flex: 1;
    }

    .alert-title {
        font-size: 1rem;
        font-weight: 600;
        color: #f9fafb;
        margin-bottom: 5px;
    }

    .alert-message {
        font-size: 0.9rem;
        color: #d1d5db;
        margin: 0;
    }

    .alert-action {
        background: var(--primary-gradient);
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.8rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .alert-action:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
        color: white;
        text-decoration: none;
    }

    /* Tabelas */
    .table-container {
        background: #1f2937;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #4b5563;
    }

    .table-header {
        background: #4b5563;
        padding: 15px 20px;
        border-bottom: 1px solid #6b7280;
    }

    .table-title {
        font-size: 1rem;
        font-weight: 600;
        color: #f9fafb;
        margin: 0;
    }

    .table-content {
        max-height: 400px;
        overflow-y: auto;
    }

    .table-modern {
        width: 100%;
        border-collapse: collapse;
    }

    .table-modern th {
        background: #374151;
        color: #d1d5db;
        font-weight: 600;
        padding: 12px 20px;
        text-align: left;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 1px solid #4b5563;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .table-modern td {
        padding: 12px 20px;
        border-bottom: 1px solid #374151;
        color: #e5e7eb;
        font-size: 0.9rem;
    }

    .table-modern tbody tr:hover {
        background: #374151;
    }

    .table-modern tbody tr:last-child td {
        border-bottom: none;
    }

    /* Responsividade */
    @media (max-width: 1200px) {
        
    }

    @media (max-width: 768px) {

    }

    /* Animações */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .metric-card:nth-child(1) { animation-delay: 0.1s; }
    .metric-card:nth-child(2) { animation-delay: 0.2s; }
    .metric-card:nth-child(3) { animation-delay: 0.3s; }
    .metric-card:nth-child(4) { animation-delay: 0.4s; }
    .metric-card:nth-child(5) { animation-delay: 0.5s; }
    .metric-card:nth-child(6) { animation-delay: 0.6s; }

    /* Melhorias para botões de navegação */
    .nav-buttons-container {
        position: relative;
        z-index: 10;
        margin-top: 30px;
        padding: 25px;
        background: #374151;
        border-radius: 16px;
        border: 1px solid #4b5563;
    }

    .nav-buttons-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .nav-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 18px 24px;
        text-decoration: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 2;
        min-height: 60px;
    }

    .nav-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        color: white;
        text-decoration: none;
    }

    .nav-button i {
        font-size: 1.1rem;
    }

    .nav-button span {
        font-size: 0.95rem;
    }

    /* Responsividade melhorada */
    @media (max-width: 768px) {

        .nav-button span {
            font-size: 0.9rem;
        }
    }

    @media (max-width: 480px) {

    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
            <div>
                <h1 class="dashboard-title">
                    <i class="fas fa-chart-line"></i>
                    Dashboard Executivo
                </h1>
                <p class="dashboard-subtitle">
                    Visão geral do sistema de gestão de stock - {{ periodo_analise }}
                </p>
            </div>
            <div style="display: flex; gap: 15px; align-items: center; position: relative; z-index: 1000;">
                <button onclick="testClick()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 12px 20px; border-radius: 10px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; cursor: pointer; position: relative; z-index: 1001;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                    <i class="fas fa-sync-alt"></i>
                    Atualizar
                </button>
                <a href="{% url 'stock:main' %}" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); padding: 12px 20px; border-radius: 10px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; position: relative; z-index: 1001;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
                    <i class="fas fa-arrow-left"></i>
                    Voltar ao Stock
                </a>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="dashboard-content">
        <!-- Métricas Principais -->
        <div class="metrics-grid">
            <div class="metric-card success">
                <div class="metric-header">
                    <span class="metric-title">Total de Requisições</span>
                    <div class="metric-icon success">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                </div>
                <div class="metric-value">{{ total_requisicoes }}</div>
                <p class="metric-description">Requisições internas e externas</p>
            </div>

            <div class="metric-card warning">
                <div class="metric-header">
                    <span class="metric-title">Pendentes</span>
                    <div class="metric-icon warning">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
                <div class="metric-value">{{ requisicoes_pendentes }}</div>
                <p class="metric-description">Aguardando aprovação</p>
            </div>

            <div class="metric-card info">
                <div class="metric-header">
                    <span class="metric-title">Aprovadas</span>
                    <div class="metric-icon info">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="metric-value">{{ requisicoes_aprovadas }}</div>
                <p class="metric-description">Prontas para processamento</p>
            </div>

            <div class="metric-card success">
                <div class="metric-header">
                    <span class="metric-title">Finalizadas</span>
                    <div class="metric-icon success">
                        <i class="fas fa-check-double"></i>
                    </div>
                </div>
                <div class="metric-value">{{ requisicoes_finalizadas }}</div>
                <p class="metric-description">Processo completo</p>
            </div>

            <div class="metric-card purple">
                <div class="metric-header">
                    <span class="metric-title">Movimentações</span>
                    <div class="metric-icon purple">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                </div>
                <div class="metric-value">{{ total_movimentacoes }}</div>
                <p class="metric-description">Total de movimentações</p>
            </div>

            <div class="metric-card danger">
                <div class="metric-header">
                    <span class="metric-title">Stock Baixo</span>
                    <div class="metric-icon danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="metric-value">{{ itens_stock_baixo }}</div>
                <p class="metric-description">Itens abaixo do mínimo</p>
            </div>
        </div>

        <!-- Seções de Conteúdo -->
        <div class="content-sections">
            <!-- Alertas -->
            <div class="content-section">
                <h3 class="section-title">
                    <i class="fas fa-bell"></i>
                    Alertas Importantes
                </h3>
                
                {% if alertas %}
                    {% for alerta in alertas %}
                    <div class="alert {{ alerta.tipo }}">
                        <div class="alert-icon">
                            <i class="{{ alerta.icone }}"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">{{ alerta.titulo }}</div>
                            <p class="alert-message">{{ alerta.mensagem }}</p>
                        </div>
                        <a href="{{ alerta.url }}" class="alert-action">
                            Ver Detalhes
                        </a>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert info">
                        <div class="alert-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Sistema Operacional</div>
                            <p class="alert-message">Nenhum alerta crítico no momento</p>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Requisições por Sucursal -->
            <div class="content-section">
                <h3 class="section-title">
                    <i class="fas fa-building"></i>
                    Requisições por Sucursal
                </h3>
                
                {% if requisicoes_por_sucursal %}
                    <div class="table-container">
                        <div class="table-header">
                            <h4 class="table-title">Distribuição de Requisições</h4>
                        </div>
                        <div class="table-content">
                            <table class="table-modern">
                                <thead>
                                    <tr>
                                        <th>Sucursal</th>
                                        <th>Total</th>
                                        <th>Internas</th>
                                        <th>Externas</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for|default:0 items in requisicoes_por_sucursal %}
                                    <tr>
                                        <td>{{ item.sucursal }}</td>
                                        <td><strong>{{ item.total }}</strong></td>
                                        <td>{{ item.internas }}</td>
                                        <td>{{ item.externas }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% else %}
                    <p style="color: #9ca3af; text-align: center; padding: 20px;">
                        Nenhuma requisição encontrada
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- Movimentações Recentes -->
        <div class="content-section">
            <h3 class="section-title">
                <i class="fas fa-history"></i>
                Movimentações Recentes
            </h3>
            
            {% if movimentacoes_recentes %}
                <div class="table-container">
                    <div class="table-header">
                        <h4 class="table-title">Últimas 10 Movimentações</h4>
                    </div>
                    <div class="table-content">
                        
                    </div>
                </div>
            {% else %}
                <p style="color: #9ca3af; text-align: center; padding: 20px;">
                    Nenhuma movimentação encontrada
                </p>
            {% endif %}
        </div>

        <!-- Gráficos Interativos -->
        <div class="content-section">
            <h3 class="section-title">
                <i class="fas fa-chart-bar"></i>
                Análise Visual
            </h3>
            
            <!-- Filtros para Gráficos -->
            <div style="background: #1f2937; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #4b5563;">
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label style="color: #d1d5db; font-weight: 600;">Período:</label>
                    <select id="periodoSelect" onchange="updateCharts()" style="background: #374151; border: 1px solid #4b5563; color: #f9fafb; padding: 8px 12px; border-radius: 8px;">
                        <option value="7">Últimos 7 dias</option>
                        <option value="30" selected>Últimos 30 dias</option>
                        <option value="90">Últimos 90 dias</option>
                    </select>
                    
                    <label style="color: #d1d5db; font-weight: 600;">Tipo:</label>
                    <select id="tipoItemSelect" onchange="updateCharts()" style="background: #374151; border: 1px solid #4b5563; color: #f9fafb; padding: 8px 12px; border-radius: 8px;">
                        <option value="">Todos</option>
                        <option value="PRODUTO">Produtos</option>
                        <option value="MATERIAL">Materiais</option>
                    </select>
                    
                    <button onclick="updateCharts()" style="background: var(--primary-gradient); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                </div>
            </div>
            
            <!-- Grid de Gráficos -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
                <!-- Gráfico de Movimentações -->
                <div style="background: #1f2937; border-radius: 12px; padding: 20px; border: 1px solid #4b5563;">
                    <h4 style="color: #f9fafb; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-bar" style="color: #8b5cf6;"></i>
                        Movimentações por Dia
                    </h4>
                    <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="movimentacoesChart"></canvas>
                    </div>
                </div>

                <!-- Gráfico de Estoque por Sucursal -->
                <div style="background: #1f2937; border-radius: 12px; padding: 20px; border: 1px solid #4b5563;">
                    <h4 style="color: #f9fafb; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-pie" style="color: #8b5cf6;"></i>
                        Estoque por Sucursal
                    </h4>
                    <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="estoqueSucursalChart"></canvas>
                    </div>
                </div>

                <!-- Gráfico de Categorias -->
                <div style="background: #1f2937; border-radius: 12px; padding: 20px; border: 1px solid #4b5563;">
                    <h4 style="color: #f9fafb; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-area" style="color: #8b5cf6;"></i>
                        Top 10 Categorias
                    </h4>
                    <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="categoriasChart"></canvas>
                    </div>
                </div>

                <!-- Gráfico de Tendências -->
                <div style="background: #1f2937; border-radius: 12px; padding: 20px; border: 1px solid #4b5563;">
                    <h4 style="color: #f9fafb; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-chart-line" style="color: #8b5cf6;"></i>
                        Tendências de Valor
                    </h4>
                    <div style="position: relative; height: 300px; width: 100%;">
                        <canvas id="tendenciasChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navegação -->
        <div class="nav-buttons-container">
            <h3 style="color: #f9fafb; margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 1.3rem;">
                <i class="fas fa-compass" style="color: #8b5cf6;"></i>
                Navegação Rápida
            </h3>
            
            <div class="nav-buttons-grid">
                <a href="{% url 'stock:requisicoes:list' %}" class="nav-button">
                    <i class="fas fa-list"></i>
                    <span>Requisições</span>
                </a>
                
                <a href="{% url 'stock:movimentos' %}" class="nav-button">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Movimentações</span>
                </a>
                
                <a href="{% url 'stock:notificacoes_list' %}" class="nav-button">
                    <i class="fas fa-bell"></i>
                    <span>Notificações</span>
                </a>
                
                <a href="{% url 'stock:alertas_gerenciar' %}" class="nav-button">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Alertas</span>
                </a>
                
                <a href="{% url 'stock:reports' %}" class="nav-button">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
                
                <a href="{% url 'stock:inventario:list' %}" class="nav-button">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Inventário</span>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}

{% endblock %}
