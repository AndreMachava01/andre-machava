{% extends 'base_list.html' %}
{% load static %}

{% block title %}Stock por Sucursal{% endblock %}

{% block extra_style %}
<style>
    /* Estilos específicos do módulo - apenas gradiente no header */
    .page-header,
    .hero-section,
    .dashboard-header,
    .nav-top {
        background: var(--purple-gradient);
    }
</style>
{% endblock %}

{% block content %}
<div class="modern-container">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">
                <i class="fas fa-warehouse"></i>
                Stock por Sucursal
            </h1>
            <p class="hero-subtitle">Visualize o stock atual de produtos por sucursal</p>
            <div class="hero-actions">
                <a href="{% url 'stock:main' %}" class="btn-modern btn-primary-modern">
                    <i class="fas fa-home"></i>
                    Voltar ao Stock
                </a>
                <a href="" class="btn-modern btn-success-modern">
                    <i class="fas fa-plus"></i>
                    Novo Movimento
                </a>
            </div>
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="summary-card">
            <div class="stat-icon">
                <i class="fas fa-list"></i>
            </div>
            <div class="summary-value">{{ stocks.count|default:"0" }}</div>
            <div class="summary-card h3">Registros de Stock</div>
        </div>
        <div class="summary-card">
            <div class="stat-icon">
                <i class="fas fa-building"></i>
            </div>
            <div class="summary-value">{{ sucursais_count|default:"0" }}</div>
            <div class="summary-card h3">Sucursais</div>
        </div>
        <div class="summary-card">
            <div class="stat-icon">
                <i class="fas fa-box"></i>
            </div>
            <div class="summary-value">{{ produtos_count|default:"0" }}</div>
            <div class="summary-card h3">Produtos</div>
        </div>
        <div class="summary-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="summary-value">{{ stock_baixo_count|default:"0" }}</div>
            <div class="summary-card h3">Stock Baixo</div>
        </div>
    </div>

    <!-- Content Section -->
    <div class="content-section">
        <!-- Filters -->
        <!-- Filtros -->
{% include 'includes/filters_unified.html' with entity_name='stock_sucursal' %}

        <!-- Stock Table -->
        <div class="table-container">
            {% if stocks %}
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Código</th>
                            <th>Sucursal</th>
                            <th class="text-center">Stock Atual</th>
                            <th class="text-center">Stock Reservado</th>
                            <th class="text-center">Disponível</th>
                            <th class="text-center">Status</th>
                            <th class="text-center">Última Atualização</th>
                            <th class="text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stock in stocks %}
                            <tr>
                                <td>
                                    <div class="product-info">
                                        <i class="fas fa-box product-icon"></i>
                                        <div class="product-name">{{ stock.produto.nome }}</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="product-code">{{ stock.produto.codigo }}</div>
                                </td>
                                <td>
                                    <div class="sucursal-info">
                                        <i class="fas fa-building sucursal-icon"></i>
                                        <div class="sucursal-name">{{ stock.sucursal.nome }}</div>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span class="stock-badge stock-atual">{{ stock.quantidade_atual }}</span>
                                </td>
                                <td class="text-center">
                                    <span class="stock-badge stock-reservado">{{ stock.quantidade_reservada }}</span>
                                </td>
                                <td class="text-center">
                                    <span class="stock-badge stock-disponivel">{{ stock.quantidade_disponivel }}</span>
                                </td>
                                <td class="text-center">
                                    {% if stock.status_estoque == 'BAIXO' %}
                                        <span class="status-badge status-baixo">
                                            <i class="fas fa-exclamation-triangle"></i> Baixo
                                        </span>
                                    {% elif stock.status_estoque == 'ALTO' %}
                                        <span class="status-badge status-alto">
                                            <i class="fas fa-arrow-up"></i> Alto
                                        </span>
                                    {% else %}
                                        <span class="status-badge status-normal">
                                            <i class="fas fa-check"></i> Normal
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    <div class="last-update">
                                        {{ stock.data_atualizacao|date:"d/m/Y H:i" }}
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="action-buttons">
                                        <a href="?produto={{ stock.produto.id }}&sucursal={{ stock.sucursal.id }}" 
                                           class="action-btn btn-movement" title="Registrar Movimento">
                                            <i class="fas fa-exchange-alt"></i>
                                        </a>
                                        <a href="{% url 'stock:produto_detail' stock.produto.id %}" 
                                           class="action-btn btn-view" title="Ver Produto">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <h4>Nenhum stock encontrado</h4>
                    <p>
                        {% if sucursal_selecionada or produto_selecionado %}
                            Não há registros de stock para os filtros selecionados.
                        {% else %}
                            Não há produtos em stock. Registre o primeiro movimento para começar.
                        {% endif %}
                    </p>
                    <a href="{% url 'stock:movimento_add' %}" class="btn">
                        <i class="fas fa-plus"></i>
                        Registrar Primeiro Movimento
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Adicionar funcionalidade aos filtros
document.addEventListener('DOMContentLoaded', function() {
    // Filtro de sucursal
    const sucursalSelect = document.getElementById('sucursal');
    if (sucursalSelect) {
        sucursalSelect.addEventListener('change', function() {
            const form = this.closest('form');
            form.submit();
        });
    }
    
    // Filtro de produto
    const produtoSelect = document.getElementById('produto');
    if (produtoSelect) {
        produtoSelect.addEventListener('change', function() {
            const form = this.closest('form');
            form.submit();
        });
    }
});
</script>
{% endblock %}
